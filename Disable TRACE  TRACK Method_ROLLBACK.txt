#Author : Abhishek Yadav
#Reviewer : Nitin Sharma
#Unit Test : Anmol Rajat
#Date of Fix : 08/28/2017
#Objective : Rolling back the changes made by script VRG-178
#The script is written in python2 

# Note:
# 1. The user running the script must have administrative privileges.
# 2. The log file for the script will be generated at /temp.
# 3. Run this .py script if you wish to rollback the VRG-178.py solution.
# 4. This rollback script will replace the .conf file with the backup file present at the same location.
# 5. Please restart the server properly after running this script.


import os, sys, datetime, time

odat = (time.strftime("%d-%m-%Y"))
dat = datetime.datetime.now()

if os.path.exists('/tmp')==False:
        print "/tmp directory is not there, so creating /tmp"
        os.makedirs('/tmp')

file_log = '/tmp/VRG178_VulnerabilityFix_' + str(odat) + '.log'
f=open(file_log,'a+')
saveout = sys.stdout
sys.stdout = f

print "*******************Log Started for VRG-178_rollback**************************"

conf_file_name = ["apache.conf", "apache2.conf", "httpd.conf"]


def find_path():
        for root, dirs, files in os.walk(r'/'):
                for name in files:
                        if name in conf_file_name:
                                x = os.path.abspath(os.path.join(root, name))
                                return x

x = str(find_path())

print "x = ",x
y ='.VRG-178.'+str(odat)
bkpchk = x + y
dat = datetime.datetime.now()
print '\n'+str(dat)+'\n'


os.system('cp '+bkpchk+' '+x)

print ".conf file is restored from: ", bkpchk

print "***********************Log Started for VRG-178_rollback****************************"

sys.stdout = saveout
f.close()

print '.conf file is restored from: ', bkpchk
print 'check log file at; ', file_log

